---
layout: post
date: 2014-07-30 20:18:22
title: Tightening your cycles
categories: tdd
---

BDD is about constant feedback.

First of all you get feedback about the code you write. Tests are here to tell you whether it's good or bad code.

Second of you get feedback about the state of system you're working on and whether you've broke it while refactoring (or while introducing a new feature).

We can safely say that the sooner you get feedback on changes you've just introduced the better. You will be to develope faster and your flow will remain uninterrupted.

<!--more-->

That is why I *always* have a Terminal window opened. In that window I execute a script that listens for file changes in folder with source code that I'm currently working on. Whenever a change is detected these scripts runs `xcodebuild test` automatically. That way I receive feedback almost instantly.

The only problem with above trick is that output from `xcodebuild test` is not exactly readable, especially when your test suite grows large. Imagine what happens when your app reaches 2000 (or more) tests - finding which one failed would become quite a challange.

This is where [xcpretty](https://github.com/supermarin/xcpretty) comes in. It is a really simple tool - the only thing it actually does is that it parses output Xcode throws out when performing `xcodebuild test`. You get a green `.` for a passed test and a red `F` for a failed one. Plus all info you can get about a failed test. But it gets even better - since xctool doesn't print all information `xcodebuild` gives it it actually *faster* than running tests normally.

So here it is, the aforementioned script. Is uses Ruby and filewatcher gem, thus you should call `gem install filewatcher` prior to running it:

```ruby
require 'filewatcher'
require 'system-bang'

workspace_name = Dir["*.xcworkspace"].last
# We assume that the name of the file is also the name of main scheme we'll be testing
scheme_name = workspace_name.partition(".").first

exit_with_message("Expected to find a workspace in current working directory, but none found.") unless workspace_name

FileWatcher.new(["#{scheme_name}/"]).watch do |filename|
  system_command = "xcodebuild test -workspace '#{workspace_name}' -scheme '#{scheme_name}' -sdk iphonesimulator -destination \"platform=iOS Simulator,name=iPad Retina,OS=7.1\" | xcpretty -c --no-utf --test"

  puts "Executing: #{system_command}"
  system!('killall xcodebuild -t `tty` 2>/dev/null || true')
  system! system_command
end

# Helpers

def exit_with_message(msg)
  puts red(msg)
  exit 1
end

def colorize(text, color_code)
  "#{color_code}#{text}\e[0m"
end

def red(text); colorize(text, "\e[31m"); end
```

I should give my thanks to [Robert Wijas](https://github.com/robertwijas) who came up with the idea of killing all previous `xcodebuild` calls, otherwise switching branches would be quite a challange for your computer.

Enjoy and as always, if you have any comments, hit me on [Twitter](http://twitter.com/eldudi).
